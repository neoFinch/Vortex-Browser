<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="./sidebar.css">
</head>

<body>
  <div id="sidebar">
    <div class="tip"> Press <span>CMD + .</span> to toggle sidebar </div>
    <div>
      <input autofocus type="text" id="urlBar" placeholder="Enter URL" onkeyup="navigate(event)">
    </div>
    <div>
      <button id="newTab" onclick="createTab()">New Tab</button>
    </div>
    <div id="tabList"></div>
  </div>
</body>
<script>
  function navigate(e) {
    if (e.key === 'Enter') {
      const url = document.getElementById('urlBar').value;
      if (url.length > 0) {
        if (url.startsWith('http')) {
          window.electronAPI.navigate(url);
        } else {
          window.electronAPI.navigate('https://' + url);
        }
      }
    }
  }

  function createTab() {
    console.log('createTab button clicked')
    window.electronAPI.createTab('https://www.google.com');
  }

  // In your sidebar JavaScript
  window.electronAPI.onUpdateTabs((event, { tabs, activeTabId }) => {
    console.log('Received updated tabs:', tabs);
    console.log('Active tab ID:', activeTabId);
    // Update your sidebar UI with the new tab information
    updateTabsUI(tabs, activeTabId);
  });

  function updateTabsUI(tabs, activeTabId) {
    // Clear existing tabs
    const tabList = document.getElementById('tabList');
    tabList.innerHTML = '';

    // Add new tabs
    tabs.forEach(tab => {
      const tabElement = document.createElement('div');
      tabElement.textContent = tab.url.substring(0, 30);
      tabElement.onclick = () => window.electronAPI.switchTab(tab.id);
      if (tab.id === activeTabId) {
        tabElement.classList.add('active');
      }
      // // let deleteBtn = document.createElement('button').textContent = 'X';
      // // deleteBtn.onclick = () => window.electronAPI.closeTab(tab.id);
      // // tabElement.appendChild(deleteBtn);
      // tabElement.innerHTML += `<button onclick="closeTab(${event},${tab.id})">X</button>`;
      let deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'X';
      deleteBtn.onclick = (event) => closeTab(event,tab.id);
      tabElement.appendChild(deleteBtn);
      tabList.appendChild(tabElement);
    });

    // set correct url bar value
    document.getElementById('urlBar').value = tabs[activeTabId].url;
  }

  // window.electronAPI.switchTab(tabId);

  // check if page is navigated
  window.electronAPI.onPageNavigated((event, url) => {
    console.log('Page navigated to:', url);
  });

  function closeTab(event,id) {
    console.log('closig :',event);
    event.stopPropagation();
    console.log('closeTab', id);
    window.electronAPI.closeTab(id);
  }
  window.addEventListener('keyup', (event) => {
    console.log('keyup', event.key)
  })
</script>

</html>